<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>get the default app related a file mime type using python</title>
    <meta name="description" content="sometime you want to get the app list related to a file mime type.for example, you design a desktop app and you want let the user set theprogram to opening a...">

    <!-- style -->
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600">
    <link rel="stylesheet" href=" /css/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href=" /css/customer/syntax.css ">
    <link rel="stylesheet" href=" /css/customer/customer.css ">
    <!-- bootstrap3 -->
    <link rel="stylesheet" href=" /css/bootstrap3/css/bootstrap.min.css ">
    <link rel="canonical" href="http://smileboywtu.github.io/articles/2016/03/13/python-get-system-default-app-related-a-mime-type.html">

    <!-- isso comment system -->
    <script data-isso="//121.42.178.129" data-isso-lang="en" data-isso-css="true" src="//121.42.178.129/js/embed.min.js"></script>

    <!-- bootstrap 3 -->
    <script src=" /css/bootstrap3/js/jquery-1.12.0.min.js "></script>
    <script src=" /css/bootstrap3/js/bootstrap.min.js "></script>

    <!-- owner special recommendation -->
    <script>
        $.get(
            "http://121.42.178.129/recommendation/music",
            function(data){
                $('#recommendation').append(data);
            },"html");
    </script>

    
    <script>
        $(document).ready(function() {
            $("#id-page-get the default app related a file mime type using python-title").addClass("active");
        });
    </script>
    

</head>


<body>
    <div>
        <header>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Coder Life</a>
            </div>

            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li id="id-page-Projects-title">
                        <a href=" /Projects/ ">Projects</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Explore <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li id="id-page-About-title"><a href=" /About/ ">About</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="https://github.com/smileboywtu"><i class="fa fa-github"></i> GitHub</a></li>
                            <li><a href="http://smileboywtu.deercv.com"><i class="fa fa-user"></i> Deer CV</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

</header>


        <div class="container-fluid">
            <div class="row default">
                <div class="col-lg-6">
                    <div class="post" itemscope itemtype="http://schema.org/BlogPosting">

    <h2 class="post-title">get the default app related a file mime type using python</h2>

    <p class="post-meta">
        <small>
            <time datetime="2016-03-13T13:29:00+08:00" itemprop="datePublished">
                Mar 13, 2016
            </time>
        </small>
    <p>

    <div class="post-content">
        <p>sometime you want to get the app list related to a file mime type.
for example, you design a desktop app and you want let the user set the
program to opening a file. so here you need to get all the programs which
can opening a kind of file. python is cross-platform language, so it’s
very complex to do so. we start with a simple one:</p>

<p>Here we just support for</p>

<ul>
  <li>windows</li>
  <li>linux</li>
  <li>mac</li>
</ul>

<h2 id="open-file-using-the-default-app">open file using the default app</h2>

<p>before you do so, you need to get the platform you use. there is a lib: <strong>sys</strong>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">sys</span>
<span class="k">print</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span></code></pre></figure>

<p>you may use the code below to make your program cross-platform:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'darwin'</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">'mac'</span>
<span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'win32'</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">'windows'</span>
<span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'linux'</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">'linux'</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">'other os.'</span></code></pre></figure>

<p>after you get the platform, you can google the app for opening a file using
command line how-to. after that you can use the python subprocess module to
invoke the system app to open the file.</p>

<p>Here is a example use the default system program to open the file:</p>

<p>there are two lib which is very popular to invoke system binary file:</p>

<ul>
  <li>subprocess</li>
  <li>sh</li>
</ul>

<p>the second is very easy to use, but it’s only support linux and mac only. and
there is no hope support windows now, so here we can just use the subprocess.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'darwin'</span><span class="p">):</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">'open'</span><span class="p">,</span> <span class="s">'filename'</span><span class="p">])</span>
<span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'win32'</span><span class="p">):</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">'cmd'</span><span class="p">,</span> <span class="s">'/c'</span><span class="p">,</span> <span class="s">'start'</span><span class="p">,</span> <span class="s">'filename'</span><span class="p">])</span>
<span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'linux'</span><span class="p">):</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">'open'</span><span class="p">,</span> <span class="s">'filename'</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">'current no support for unknown os.'</span></code></pre></figure>

<p>there are many alternatives in linux using to open a file by default app.
you can use the <strong>open –help</strong> command to get more information.</p>

<h2 id="get-installed-binary-list">get installed binary list</h2>

<p>this come to an not easy problem here, we want to let the user choose the
installed app to open a file. before that we should send the app list to the
user, but get the list and application path is not easy.</p>

<p>after search on googles long time, i just find how to figure out the app for
for open a type of file.</p>

<p>let’s start with python source code file. <strong>.py</strong>, <strong>.pyc</strong>.</p>

<p><strong>1.</strong> open the cmd</p>

<p><strong>2.</strong> assoc .py or .pyc</p>

<p><strong>3.</strong> copy the extention filename, here in my computer is: <strong>Python.File</strong></p>

<p><strong>4.</strong> open the regedit</p>

<p><strong>5.</strong> search the file extention, here is <strong>Python.File</strong></p>

<p><strong>6.</strong> always under the <strong>HKEY_CLASSES_ROOT</strong> you can find the key.</p>

<p><strong>7.</strong> go to shell/open/command, you will see the path for the app.</p>

<p>here we start to use python to open a program this way.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">_winreg</span> <span class="kn">import</span> <span class="n">OpenKey</span><span class="p">,</span> <span class="n">EnumKey</span><span class="p">,</span> <span class="n">EnumValue</span><span class="p">,</span> <span class="n">HKEY_CLASSES_ROOT</span>

<span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">'cmd'</span><span class="p">,</span> <span class="s">'/c'</span><span class="p">,</span> <span class="s">'assoc'</span><span class="p">,</span> <span class="s">'.py'</span><span class="p">],</span>
                        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

<span class="n">file_ext</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'='</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">value</span> <span class="o">=</span> <span class="n">OpenKey</span><span class="p">(</span><span class="n">HKEY_CLASSES_ROOT</span><span class="p">,</span> <span class="n">file_ext</span> <span class="o">+</span> <span class="s">'</span><span class="err">\</span><span class="s">shell</span><span class="err">\</span><span class="s">open</span><span class="err">\</span><span class="s">command'</span><span class="p">)</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">EnumValue</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span></code></pre></figure>

<p>after you get the path, you now can get the app name from the path, then you
can start the app from the path.</p>

<p>here we just talk about the app for opening a file on windows, but others like
mac and linux, how to ?</p>

<p>here we just can open a file with the default app, but we can’t totally find a
easy way to deal with multi-platform get all the ‘open with list’ now. if you
get a good idea, you can leave me a message.</p>

<p>Here is my way: I just use the default program to open the file and give the
user a list of current installed app on the platform or let the user choose
the path of the program.</p>

<blockquote>
  <p>The information that is stored here makes sure that the correct program opens when you open a file by using Windows Explorer. This key is sometimes abbreviated as “HKCR.” Starting with Windows 2000, this information is stored under both the HKEY_LOCAL_MACHINE and HKEY_CURRENT_USER keys. The HKEY_LOCAL_MACHINE\Software\Classes key contains default settings that can apply to all users on the local computer. The HKEY_CURRENT_USER\Software\Classes key contains settings that override the default settings and apply only to the interactive user. The HKEY_CLASSES_ROOT key provides a view of the registry that merges the information from these two sources.</p>
</blockquote>

<p>on windows, I just find the way to get the open with list:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">HKEY_CURRENT_USER<span class="se">\S</span>oftware<span class="se">\M</span>icrosoft<span class="se">\W</span>indows<span class="se">\C</span>urrentVersion<span class="se">\E</span>xplorer<span class="se">\F</span>ileExts<span class="se">\</span></code></pre></figure>

<p>on mac you can read the <strong>/Applications</strong> for all the extentions inside .app
with it’s <strong>.plist</strong> file.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">plistlib</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">plistlib</span><span class="o">.</span><span class="n">readPlist</span><span class="p">(</span><span class="s">'file.plist'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s">'CFBundleDocumentTypes'</span><span class="p">]:</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s">'CFBundleTypeExtensions'</span><span class="p">])</span></code></pre></figure>

<p>now you can find all the application inside the /Applications and then get the
supported file extentions of them, and keep a copy of them inside the database.</p>

<h2 id="reference">reference</h2>

<ol>
  <li><a href="https://docs.python.org/2/library/subprocess.html">subprocess</a></li>
  <li><a href="https://amoffat.github.io/sh/">sh</a></li>
  <li><a href="http://stackoverflow.com/questions/434597/open-document-with-default-application-in-python">invoke binary</a></li>
  <li><a href="https://docs.python.org/2/library/_winreg.html">_winreg</a></li>
  <li><a href="http://superuser.com/questions/572011/how-do-i-set-up-preferred-applications-in-nautilus-by-file-extension-rather-tha/573488#573488">mimeopen</a></li>
  <li><a href="http://cpansearch.perl.org/src/PARDUS/File-MimeInfo-0.15/mimeopen">perl-mimeopen</a></li>
  <li><a href="http://apple.stackexchange.com/questions/64124/how-can-i-modify-the-list-of-applications-under-open-with">mac associations</a></li>
  <li><a href="http://www.howtogeek.com/165293/how-to-get-a-list-of-software-installed-on-your-pc-with-a-single-command/">list installed app</a></li>
  <li><a href="http://helpdeskgeek.com/how-to/generate-a-list-of-installed-programs-in-windows/">window cmd list installed app</a></li>
  <li><a href="http://superuser.com/questions/447277/list-all-installed-software-on-pc">windows how to</a></li>
  <li><a href="http://stackoverflow.com/questions/3924753/where-does-windows-store-its-open-with-settings">open with list</a></li>
  <li><a href="http://mac-how-to.wonderhowto.com/how-to/remove-duplicates-customize-open-with-menu-mac-os-x-0157100/">mac application extentions</a></li>
</ol>

    </div>

    
    <hr>
    <div class="post-comments">
        <section id="isso-thread"></section>
    </div>

    

</div>

                </div>
                <div class="col-lg-6">
                    <div class="recommendation-default">
                        <div class="table-responsive" id="recommendation">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
    <div class="container">

        <div>
            <a href="https://github.com/smileboywtu">
                <span class="icon"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span>
            </a>
        </div>

        <div class="text-muted">
            <small>Designed By Smile Boy.</small>
        </div>

    </div>
</footer>

    </div>
</body>


</html>

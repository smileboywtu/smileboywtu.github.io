<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>metaclass in python</title>
    <meta name="description" content="a metaclass is the class of the class. like a class define how an instancebehaves, a metaclass defines how a class behaves. a class is an instance ofa metacl...">

    <link rel="stylesheet" href=" /css/customer/syntax.css ">
    <link rel="stylesheet" href=" /css/customer/customer.css ">
    <!-- bootstrap3 -->
    <link rel="stylesheet" href=" /css/bootstrap3/css/bootstrap.min.css ">
    <link rel="canonical" href="http://smileboywtu.github.io/articles/2016/02/13/metaclass-in-python.html">

    <!-- isso comment system -->
    <script data-isso="//121.42.178.129" data-isso-lang="en" data-isso-css="true" src="//121.42.178.129/js/embed.min.js"></script>

    <!-- bootstrap 3 -->
    <script src=" /css/bootstrap3/js/jquery-1.12.0.min.js "></script>
    <script src=" /css/bootstrap3/js/bootstrap.min.js "></script>

    <!-- owner special recommendation -->
    <script>
        $.get(
            "http://121.42.178.129/recommendation",
            function(data){
                $('#recommendation').append(data);
            },"html");
    </script>

    
    <script>
        $(document).ready(function() {
            $("#id-page-metaclass in python-title").addClass("active");
        });
    </script>
    

</head>


<body>
    <div>
        <header>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Coder Life</a>
            </div>

            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li id="id-page-Projects-title">
                        <a href=" /Projects/ ">Projects</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Explore <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li id="id-page-About-title"><a href=" /About/ ">About</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="https://github.com/smileboywtu">GitHub</a></li>
                            <li><a href="http://smileboywtu.deercv.com">Deer CV</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

</header>


        <div class="container-fluid">
            <div class="row default">
                <div class="col-lg-6">
                    <div class="post" itemscope itemtype="http://schema.org/BlogPosting">

    <h2 class="post-title">metaclass in python</h2>

    <p class="post-meta">
        <small>
            <time datetime="2016-02-13T07:58:00+08:00" itemprop="datePublished">
                Feb 13, 2016
            </time>
        </small>
    <p>

    <div class="post-content">
        <p><em>a metaclass is the class of the class. like a class define how an instance
behaves, a metaclass defines how a class behaves. a class is an instance of
a metaclass.</em></p>

<p>what many people do not realize, though, is that quite literally <strong>everything</strong>
in python language is an object.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"my style of int class."</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">MyClass</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

<span class="n">one</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">one</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span></code></pre></figure>

<p>here you can see that a object, which is an instance of MyClass can add to an
integer. we see int really is an object that can be subclassed and extended
just like user-defined classes.</p>

<p>we all know in oop language, the type of objects are instances of classes. so
what’s the type of the class?</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Owner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Owner</span><span class="p">))</span>

<span class="nb">type</span></code></pre></figure>

<p>what this shows in python, classes are objects, and they are objects of type type.
type is the a metaclass: a class which instantiates classes. all new-style
classes in python are instances of the type metaclass, including type itself.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="nb">type</span><span class="p">))</span>

<span class="nb">type</span></code></pre></figure>

<p>all class definition process is the process of instantiating type class.
we can learn this from an example:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># type(name, bases, dict)</span>
<span class="n">Owner</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s">'Owner'</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,),</span> <span class="p">{})</span>

<span class="n">one</span> <span class="o">=</span> <span class="n">Owner</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">one</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>

<span class="mi">5</span></code></pre></figure>

<p>so we can use the __new__ or __init__ to customer the process of
creating new class. there comes the metaclass in python.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span><span class="err">；</span>
       <span class="nb">super</span><span class="p">(</span><span class="n">Meta</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Owner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">Meta</span></code></pre></figure>

<p>use __init__ or __new__ in metaclass?</p>

<p><strong>__new__ is called for the creation of a new class, while __init__ is
called after the class is created, to perform additional initialization before
the class is handed to the caller</strong>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="k">class</span> <span class="nc">Tag1</span><span class="p">:</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">Tag2</span><span class="p">:</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">Tag3</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">tag3_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>

<span class="k">class</span> <span class="nc">MetaBase</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">mcl</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">nmspc</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'MetaBase.__new__</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">MetaBase</span><span class="p">,</span> <span class="n">mcl</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">mcl</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">nmspc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">nmspc</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'MetaBase.__init__</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MetaBase</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">nmspc</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MetaNewVSInit</span><span class="p">(</span><span class="n">MetaBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">mcl</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">nmspc</span><span class="p">):</span>
        <span class="c"># First argument is the metaclass ``MetaNewVSInit``</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'MetaNewVSInit.__new__'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mcl</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">nmspc</span><span class="p">):</span> <span class="n">pprint</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>
        <span class="c"># These all work because the class hasn't been created yet:</span>
        <span class="k">if</span> <span class="s">'foo'</span> <span class="ow">in</span> <span class="n">nmspc</span><span class="p">:</span> <span class="n">nmspc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">'foo'</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s">'_x'</span>
        <span class="n">bases</span> <span class="o">+=</span> <span class="p">(</span><span class="n">Tag1</span><span class="p">,)</span>
        <span class="n">nmspc</span><span class="p">[</span><span class="s">'baz'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">MetaNewVSInit</span><span class="p">,</span> <span class="n">mcl</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">mcl</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">nmspc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">nmspc</span><span class="p">):</span>
        <span class="c"># First argument is the class being initialized</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'MetaNewVSInit.__init__'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">nmspc</span><span class="p">):</span> <span class="n">pprint</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">'bar'</span> <span class="ow">in</span> <span class="n">nmspc</span><span class="p">:</span> <span class="n">nmspc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">'bar'</span><span class="p">)</span> <span class="c"># No effect</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s">'_y'</span> <span class="c"># No effect</span>
        <span class="n">bases</span> <span class="o">+=</span> <span class="p">(</span><span class="n">Tag2</span><span class="p">,)</span> <span class="c"># No effect</span>
        <span class="n">nmspc</span><span class="p">[</span><span class="s">'pi'</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.14159</span> <span class="c"># No effect</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MetaNewVSInit</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">nmspc</span><span class="p">)</span>
        <span class="c"># These do work because they operate on the class object:</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+=</span> <span class="s">'_z'</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">__bases__</span> <span class="o">+=</span> <span class="p">(</span><span class="n">Tag3</span><span class="p">,)</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="mf">2.718</span>

<span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">MetaNewVSInit</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Test.__init__'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">print</span><span class="p">(</span><span class="s">'foo still here'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">print</span><span class="p">(</span><span class="s">'bar still here'</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Test</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'class name: '</span> <span class="o">+</span> <span class="n">Test</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'base classes: '</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Test</span><span class="o">.</span><span class="n">__bases__</span><span class="p">])</span>
<span class="k">print</span><span class="p">([</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"__"</span><span class="p">)])</span>
<span class="n">t</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>

<span class="s">""" Output:
MetaNewVSInit.__new__
&lt;class '__main__.MetaNewVSInit'&gt;
'Test'
(&lt;type 'object'&gt;,)
{'__init__': &lt;function __init__ at 0x7ecf0&gt;,
 '__metaclass__': &lt;class '__main__.MetaNewVSInit'&gt;,
 '__module__': '__main__',
 'bar': &lt;function bar at 0x7ed70&gt;,
 'foo': &lt;function foo at 0x7ed30&gt;}

MetaBase.__new__

MetaNewVSInit.__init__
&lt;class '__main__.Test_x'&gt;
'Test'
(&lt;type 'object'&gt;,)
{'__init__': &lt;function __init__ at 0x7ecf0&gt;,
 '__metaclass__': &lt;class '__main__.MetaNewVSInit'&gt;,
 '__module__': '__main__',
 'bar': &lt;function bar at 0x7ed70&gt;,
 'baz': 42}

MetaBase.__init__

Test.__init__
class name: Test_x_z
('base classes: ', ['object', 'Tag1', 'Tag3'])
['bar', 'baz', 'e', 'tag3_method']
bar still here
2.718
"""</span></code></pre></figure>

<p>The primary difference is that when overriding __new__() you can change
things like the ‘name’, ‘bases’ and ‘namespace’ arguments before you call the
super constructor and it will have an effect, but doing the same thing in
__init__() you won’t get any results from the constructor call.</p>

<p>Note that, since the base-class version of __init__() doesn’t make any
modifications, it makes sense to call it first, then perform any additional
operations. In C++ and Java, the base-class constructor must be called as the
first operation in a derived-class constructor, which makes sense because
derived-class constructions can then build upon base-class foundations.</p>

<p>you should prefer to use __init__ instead of __new__ but for you must
have to use __new__.</p>

<h1 id="reference">reference</h1>

<ol>
  <li><a href="http://python-3-patterns-idioms-test.readthedocs.org/en/latest/Metaprogramming.html">metaprogramming</a></li>
  <li><a href="https://jakevdp.github.io/blog/2012/12/01/a-primer-on-python-metaclasses/">A primer on python metaclasses</a></li>
</ol>

    </div>

    
    <hr>
    <div class="post-comments">
        <section id="isso-thread"></section>
    </div>

    

</div>

                </div>
                <div class="col-lg-6">
                    <div id="recommendation">
                        <p><small> smile's recommendation </small></p>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
    <div class="container-fluid">
        <div class="container row">
            <div class="col-xs-5">
                <p class="text-muted text-left text-primary text-justify">
                    <small>Designed By Smile Boy.</small>
                </p>
            </div>
            <div class="col-xs-1">
                <a href="https://github.com/smileboywtu">
                    <span class="icon"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span>
                </a>
            </div>
        </div>
    </div>
</footer>

    </div>
</body>


</html>
